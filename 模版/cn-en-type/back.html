<!-- Github: https://github.com/lesca/anki/ -->
<div class="section">
  <div id="back" class="items">
    <input type="text" id="retype" placeholder="{{单词}}">
    {{type:单词}}
  </div>
  <hr>
  <div id="sound" class="items">
    {{#发音}}{{发音}}{{/发音}}
    {{^发音}}
    <div id="anki_tts">{{tts zh_CN voices=Apple_Tingting:单词}}</div>
    <div id="ankidroid_tts">[sound:https://dict.youdao.com/dictvoice?audio={{单词}}&type=2]</div>
    {{/发音}}
  </div>
  <div id="phonetic" class="items">
    {{#音标}}<b>{{音标}}</b>{{/音标}}
  </div>
  <hr>
  <div id="def" class="items">{{释义}}</div>
</div>

{{#例句}}
<div class="section">
  <hr>
  <div id="sentence" class="items">{{例句}}</div>
</div>
{{/例句}}

{{#注释}}
<div class="section">
  <hr>
  <div id="note" class="items">{{注释}}</div>
</div>
{{/注释}}

<div class="tags">
  <div style="flex-grow: 1;"></div>
  <div style="flex-grow: 1;" align="right">{{#Tags}}标签：{{/Tags}}{{^Tags}}无标签{{/Tags}}</div>
  <div style="flex-grow: 2;" align="left">{{Tags}}</div>
  <div style="flex-grow: 1;" align="right">牌组：</div>
  <div style="flex-grow: 2;" align="left">{{Deck}}</div>
</div>


<script type="text/javascript">
  if (document.documentElement.classList.contains("android")) { document.getElementById("anki_tts").innerHTML = ""; }
  else { document.getElementById("ankidroid_tts").innerHTML = ""; } 
</script>

<script type="text/javascript">
  (() => {
    let typeans = document.getElementById("typeans");
    let retypeInput = document.getElementById("retype");
    let word = "{{单词}}";

    // script to check if the word is correct
    if (typeans && typeans.textContent.includes("↓")) {
      // answer is not correct
      typeans.style.display = "none";
      retypeInput.focus();
    } else {
      // answer is correct
      retypeInput.style.display = "none";
    }

    // script to handle input event in retypeInput
    retypeInput.addEventListener("input", () => {
      let letters = retypeInput.value.split("");
      let allCorrect = true;

      letters.forEach((letter, i) => {
        if (allCorrect && letter === word[i]) {
          retypeInput.style.color = "green";
        } else {
          retypeInput.style.color = "red";
          allCorrect = false;
        }
      });
    });

    // ease2 (hard) when enter key is pressed in retypeInput
    retypeInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        if (typeof ankidroid !== 'undefined') {
          window.location.href = "signal:answer_ease2";
        } else {
          pycmd('ease2');
        }
      }
    });
  })();
</script>